<%include ../partials/include_head.ejs %>

<section class="content">

<div class="row">
<div class="col-xs-12">
<!-- box set-->
<div class="box box-primary">
    <div class="box-header with-border">
        <i class="fa fa-bar-chart-o"></i>
        <h3 class="box-title">Cell 1</h3>
        
    </div>
    <div class="box-body">
        <div id="cell1-chartLegend"></div>
        <div id="cell1-chart" style="height:300px;"></div>
    </div>
</div>

<div class="box box-primary">
    <div class="box-header with-border">
        <i class="fa fa-fw fa-file-image-o"></i>
        <h3 class="box-title">Cell 1 Image</h3>
        
    </div>
    <div class="box-body">
        <div id="show-image">
            <img style="height:100%;width:100%;">
        </div>
    </div>
</div>

</div>
</div>
</div>
</section>
<% include ../partials/include_footer.ejs %>
<!-- FLOT CHARTS -->
<script src="/static/plugins/flot/jquery.flot.min.js"></script>
<!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
<script src="/static/plugins/flot/jquery.flot.resize.min.js"></script>
<!-- FLOT PIE PLUGIN - also used to draw donut charts -->
<script src="/static/plugins/flot/jquery.flot.pie.min.js"></script>
<!-- FLOT TIME PLUGIN - also used to time charts -->
<script src="/static/plugins/flot/jquery.flot.time.js"></script>
<!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
<script src="/static/plugins/flot/jquery.flot.categories.min.js"></script>
<!-- custom javascript chart -->
<script src="/static/chart_function/float_input.js"></script>
<!-- Morris.js charts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="/static/plugins/morris/morris.min.js"></script>
<!-- FastClick -->

<!-- date-range-picker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
<script src="/static/plugins/daterangepicker/daterangepicker.js"></script>
<script type="text/javascript">
 $(document).ready(function(){
     function labelFormatter(label, series) {
                return '<div style="font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;">' +
                    label +
                    "<br>" +
                    Math.round(series.percent) +
                    "%</div>";
            }
    function getCell1(){
        $.ajax({
            type:"GET",
            url:"/device?no=1",
            dataType:"json",
            error:function()
            {
                var cell1Ajax;
                cell1Ajax = null;
            },
            success:function(data)
            {
                //console.log('cell1 type ::: '+typeof(data));
                var cell1Ajax = data;
                //console.log("get cell3 data ::: "+data);
                var waterData = new Array();
                var tempData = new Array();
                var getWaterData = [];
                var getTempData = [];
                for(var i in cell1Ajax)
                {
                    //console.log("cell 1 :::: "+cell1Ajax[i]);
                    //console.log("cell1 water :::: "+cell1Ajax[i].waterContent);
                    getWaterData.push([(cell1Ajax.length - i),cell1Ajax[i].waterContent]);
                    //console.log("cell1 temp :::: "+cell1Ajax[i].temp);
                    getTempData.push([(cell1Ajax.length - i),cell1Ajax[i].temp]);
                }
                var colorArr = ["#3c8dbc", "#00c0ef"];
                var levelIs = ["water","temp"];
                data_line = [{data:getWaterData.reverse(), color:colorArr[0],label:levelIs[0]},{data:getTempData.reverse(), color:colorArr[1], label:levelIs[1]}];
                //make chart
                $.plot("#cell1-chart", data_line, {
                            grid: {
                                hoverable: true,
                                borderColor: "#f3f3f3",
                                borderWidth: 1,
                                tickColor: "#f3f3f3"
                            },
                            series: {
                                shadowSize: 0,
                                lines: {
                                    show: true
                                },
                                points: {
                                    show: true
                                }
                            },
                            lines: {
                                fill: false
                            },
                            yaxis: {
                                show: true
                            },
                            xaxis: {
                                // 이 설정은 x축의 보여지는 것이 날짜 기준으로 하기 위해서 있는 것이다.                                
                                mode: "categories",
                                show: true
                            },
                               legend: {
                                show: true,
                                noColumns: 0,
                                container: $("#cell1-chartLegend")       
                            }
                            });
                             //Initialize tooltip on hover
            $('<div class="tooltip-inner" id="cell1-chart-tooltip"></div>').css({
                position: "absolute",
                display: "none",
                opacity: 0.8
            }).appendTo("body");
            $("#cell1-chart").bind("plothover", function(event, pos, item) {
                if (item) {
                    
                    var x = item.datapoint[0].toFixed(2),
                        y = item.datapoint[1].toFixed(2);
                        var num = String(Number(x) + 1);
                        var res = num.replace(/[^1-9]/g, "");
                    //$("#sensor-chart-tooltip").html(item.series.label + " of " + x + " = " + y)
                    $("#cell1-chart-tooltip").html(res + " value : " + y).css({
                        top: item.pageY + 5,
                        left: item.pageX + 5
                    }).fadeIn(200);
                } else {
                    $("#cell1-chart-tooltip").hide();
                }
            });   
            }
        });
    }

    var get_image = function()
    {
        $.ajax({
            type:"GET",
            url:"/image?no=1",
            dataType:"json",
            error:function()
            {
                var ajax_path;
                ajax_path="";
                //$("#show-image").find("img").attr("src", ajax_path);
            },
            success:function(data){
                var ajax_path = data;
                var img_path= "";
                console.log(data);

                if(data === "null")
                {
                    console.log("null data", ajax_path);
                    console.log('testing');
                }else{
                    var serial = data[0].folderPath;
                    var folderPath = data[0].filePath;
                    var fileName = data[0].Name;
                    console.log('serial ::: '+serial);
                    console.log('file path ::: '+folderPath);
                    console.log('file name ::: '+fileName);
                    var imgPath = serial+'/'+folderPath+'/'+fileName;
                    var getImageUrl = "http://www.iof.center/DeviceImage/"+imgPath;
                    console.log(getImageUrl);
                    $("#show-image").find("img").attr("src", getImageUrl);
                }
            }
        });
    }

    
    getCell1();
    get_image();
 });
</script>
</body>
</html>

